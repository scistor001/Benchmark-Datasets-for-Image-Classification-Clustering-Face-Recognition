# 视频分析使用说明：
## 部署docker服务
> 1. 镜像文件位置：机器：192.168.31.7，路径/root/AI_Video_Analysis
> 2. 文件说明：video_analysis.tar：镜像文件包；test_video文件夹：100个reid的测试视频；video_label.txt：100个reid测试视频的label；query文件夹：目标人物信息；action_test_video：行为识别测试视频。
> 3. 加载镜像文件：docker load --input video_analysis.tar
> 4. 启动镜像建立容器：docker run --rm -itd -p 30080:30080 video_analysis:v1.0
>   环境需要: GPU:0至少7个G内存

## API调用
调用API：
	1. 行为识别：http://127.0.0.1:30080/action/ 
 	2. 行人重识别：http://127.0.0.1:30080/reid/（行人重识别需建立待识别人员库信息，100个测试视频中人员库已建好）
   	3. 行人重识别性能测试：http://127.0.0.1:30080/reid/pr

```python
# python Demo:
import requests

if __name__ == "__main__":
    
    files = {'file': ("test.mp4", open(r'/mnt/2t/home/datasets/TB/test.mp4', 'rb'))}
    response = requests.post("http://127.0.0.1:30080/action/", data=None, files=files, verify=False, stream=True)
    response = requests.post("http://127.0.0.1:30080/reid/", data=None, files=files, verify=False, stream=True)
    #reid 的pr计算（#video_path是100测试视频路径，label_txt：是100个测试视频的标签。）
    datas = {'video_path': "./test_video", 'label_txt': "./label.txt"}
    response = requests.post("http://127.0.0.1:30080/reid/pr", json=datas)
```

返回值：

1. 行为识别：
```python
   {
       "status": 0, # 暂时没用
       "message": "success", # 当成功的时候返回 "success", 失败时返回 "错误信息"
       "result": "返回结果", # 成功的时候返回识别结果，失败时返回 -1.
   }
   # "result" 结构如：{'0_44': 1, '45_50': 2} 表示：0到44秒类别为1， 45到50秒类别为2.
   # 其中类别 0表示静坐、1表示游行、2表示正常
```
2. 行人重识别：
```python
   {
       "status": 0, # 暂时没用
       "message": "success", # 当成功的时候返回 "success", 失败时返回 "错误信息"
       "result": "返回结果", # 成功的时候返回识别结果，失败时返回 -1.
   }
   # "result" 结构如：['0001', '0002'] 表示：'0001'表示识别到id为0001的人，‘0002’表示识别到id为0002的人.
```

  3.行人重识别（pr计算）：

```python
   {
       "status": 0, # 暂时没用
       "message": "success", # 当成功的时候返回 "success", 失败时返回 "错误信息"
       "result": "返回结果", # 成功的时候返回识别结果，失败时返回 -1.
   }
    # "result" 结构如：{'BWBQ_10.mp4': ['0005', '0008', '0004', '0006', '0002', '0019', '0001'] ...'PR': 'P:0.8121, R:0.8952, F1:0.8516'},表示：'BWBQ_10.mp4'视频名称，'0005'表示识别到id为0005的人。'PR'表示100个文件的精度（p），召回率（r），F1得分。
```
